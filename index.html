<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Humans + AI: Escape the Human + AI Vault ‚Äî Challenge</title>

<style>
  :root{
    --bg: #0f172a;
    --bg-alt:#111827;
    --card:#0b1222;
    --text:#e5e7eb;
    --muted:#9ca3af;
    --brand:#60a5fa;
    --brand-2:#22d3ee;
    --accent:#f59e0b;
    --success:#34d399;
    --danger:#f87171;
    --border:#1f2937;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
    --radius: 16px;
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg:#f5f7fb; --bg-alt:#eef2ff; --card:#ffffff; --text:#0b1222;
      --muted:#475569; --border:#e5e7eb; --shadow: 0 10px 30px rgba(2,6,23,.08);
    }
  }
  *{box-sizing:border-box}
  body{
    margin:0; background: radial-gradient(1200px 600px at 10% -10%, rgba(96,165,250,.25), transparent 60%),
                 radial-gradient(1000px 600px at 110% -20%, rgba(34,211,238,.25), transparent 60%),
                 var(--bg);
    color:var(--text); font: 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Arial, Noto Sans, "Apple Color Emoji","Segoe UI Emoji";
    min-height:100dvh;
    -webkit-text-size-adjust: 100%;
  }

  /* Header */
  header.hero{
    position:relative; overflow:hidden;
    padding: 36px 16px 28px;
    background: linear-gradient(135deg, rgba(96,165,250,.15), rgba(34,211,238,.15));
    border-bottom:1px solid var(--border);
  }
  .hero__inner{
    max-width: 980px; margin:0 auto; display:flex; align-items:center; gap:20px;
  }
  .hero__logo{
    width:84px; height:84px; border-radius:18px; overflow:hidden; flex:0 0 auto;
    box-shadow: var(--shadow); border:1px solid var(--border); background: var(--card);
    display:grid; place-items:center;
  }
  .hero__logo img{max-width:100%; max-height:100%; object-fit:contain}
  .hero__text{flex:1 1 auto}
  .eyebrow{
    display:inline-block; padding:4px 10px; font-size:12px; letter-spacing:.08em; text-transform:uppercase;
    border:1px solid var(--border); border-radius:999px; color:var(--muted); background:rgba(255,255,255,.02)
  }
  h1{margin:10px 0 6px; font-size: clamp(22px, 4vw, 32px); line-height:1.2}
  .tagline{margin:0; color:var(--muted)}
  .hero__badges{display:flex; gap:8px; margin-top:10px; flex-wrap:wrap}
  .badge{
    padding:6px 10px; border-radius:999px; border:1px dashed var(--border);
    color:var(--muted); font-size:12px; background:rgba(255,255,255,.02)
  }

  /* Mission Screen */
  .mission{
    max-width:980px; margin:24px auto; padding:0 16px; 
  }
  .mission-card{
    position: relative;
    background:linear-gradient(180deg, rgba(255,255,255,.02), transparent 60%), var(--card);
    border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow);
    padding:22px; overflow:hidden;
  }
  .mission-card:before{
    content:""; position:absolute; inset:0; pointer-events:none;
    background: repeating-linear-gradient(
      90deg,
      rgba(96,165,250,.06) 0, rgba(96,165,250,.06) 2px,
      transparent 2px, transparent 6px
    );
    opacity:.6;
  }
  .mission-title{margin:0 0 4px; font-size: clamp(20px, 3.5vw, 28px);}
  .mission-sub{margin:0 0 16px; color:var(--muted)}
  .mission-grid{display:grid; grid-template-columns: 1fr; gap:16px}
  @media (min-width:760px){
    .mission-grid{grid-template-columns: 1.1fr .9fr}
  }
  .scanner{
    border:1px solid var(--border); border-radius:14px; padding:16px; background: rgba(255,255,255,.03);
    position:relative; overflow:hidden; min-height:180px; display:grid; place-items:center; text-align:center;
  }
  .scan-line{
    position:absolute; left:0; right:0; height:2px; background: linear-gradient(90deg, var(--brand), var(--brand-2));
    animation: scan 2.4s linear infinite;
  }
  @keyframes scan{
    0%{ top:8px; opacity:.9 }
    50%{ top:calc(100% - 8px); opacity:.6 }
    100%{ top:8px; opacity:.9 }
  }
  .lock{ width:120px; height:120px; }
  .lock .shackle{ transform-origin: 50% 15%; transition: transform .4s ease; }
  .lock.open .shackle{ transform: rotate(-26deg) translateX(6px) translateY(-2px); }
  .mission-steps{margin:0; padding-left:18px}
  .mission-steps li{margin:6px 0}
  .mission-actions{display:flex; gap:10px; margin-top:14px; flex-wrap:wrap}
  .btn{
    appearance:none; border:none; border-radius:12px; padding:12px 16px; cursor:pointer; color:#0b1222; font-weight:700;
    background:linear-gradient(90deg, var(--brand), var(--brand-2)); box-shadow: var(--shadow);
  }
  .btn.secondary{background:transparent; color:var(--text); border:1px solid var(--border); box-shadow:none}

  /* Shell */
  .wrap{max-width:980px; margin:26px auto; padding:0 16px; display:none}
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.02), transparent 60%), var(--card);
    border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow);
    padding:22px;
  }

  /* Progress */
  .progress{
    display:flex; align-items:center; gap:12px; margin-bottom:18px; flex-wrap:wrap;
  }
  .progress__bar{
    flex:1 1 60%; height:10px; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden; border:1px solid var(--border)
  }
  .progress__bar > span{
    display:block; height:100%; width:0%;
    background: linear-gradient(90deg, var(--brand), var(--brand-2));
    transition: width .35s ease;
  }
  .progress__count{font-variant-numeric:tabular-nums; color:var(--muted)}
  .score_now{margin-left:auto; color:var(--muted)}
  .keys_now{margin-left:8px; color:var(--muted)}

  /* Question */
  .question{padding:18px; border:1px solid var(--border); border-radius:14px; margin-bottom:14px; background: rgba(255,255,255,.015)}
  .q-title{font-weight:700; margin:0 0 10px}
  .options{margin-top:8px}
  .options label{display:block; padding:10px 12px; border:1px solid var(--border); border-radius:10px; margin-bottom:8px; cursor:pointer; background:rgba(255,255,255,.02); transition: background .2s, border-color .2s}
  .options input{margin-right:8px}
  .options label.correct{border-color: var(--success); background: rgba(52,211,153,.12)}
  .options label.wrong{border-color: var(--danger); background: rgba(248,113,113,.12)}

  /* Matching (alignment + mobile-friendly) */
  .match-row{
    display:grid;
    grid-template-columns: minmax(260px, 1.2fr) 1fr;
    gap:12px;
    align-items:center;
    margin-bottom:10px;
  }
  .match-left{
    line-height:1.35;
    word-break: break-word;
  }
  .match-right select{
    width:100%;
    padding:10px 12px;
    border:1px solid var(--border);
    border-radius:10px;
    background:transparent;
    color:var(--text);
  }
  .match-row.correct select{border-color: var(--success); background: rgba(52,211,153,.12)}
  .match-row.wrong select{border-color: var(--danger); background: rgba(248,113,113,.12)}

  /* Small screens: stack prompt over dropdown, bigger tap target, prevent iOS zoom */
  @media (max-width: 560px){
    .match-row{
      grid-template-columns: 1fr;
      gap:8px;
    }
    .match-left{ margin-bottom:2px; }
    .match-right select{
      font-size:16px;      /* prevents iOS zoom on focus */
      min-height:44px;     /* comfortable tap target */
      width:100%;
    }
    .question{ padding:16px; }
  }

  /* Hint & Explanation */
  .hint, .explanation {display:none; margin-top:10px; padding:10px 12px; border-left:4px solid var(--accent); background: rgba(245,158,11,.10); border-radius:8px}
  .feedback{display:none; margin-top:10px; padding:10px 12px; border-left:4px solid var(--brand); background: rgba(96,165,250,.10); border-radius:8px; font-weight:700}

  /* Results */
  #results{display:none; margin-top:18px; padding:0}
  .result-card{display:grid; grid-template-columns: 160px 1fr; gap:18px; align-items:center; padding:22px}
  @media (max-width:640px){ .result-card{grid-template-columns:1fr} }
  .score-ring{
    --pct: 0;
    width: 160px; height:160px; border-radius:50%;
    background:
      radial-gradient(closest-side, var(--card) 80%, transparent 81% 100%),
      conic-gradient(var(--success) calc(var(--pct)*1%), rgba(255,255,255,.08) 0);
    display:grid; place-items:center; border:1px solid var(--border);
  }
  .score-ring span{font-size:28px; font-weight:800}
  .result-msg{margin:0; color:var(--muted)}

  /* Mission Accomplished banner */
  .mission-complete{
    margin: 14px 0 6px;
    display:grid;
    place-items:center;
    padding: 22px;
    border:1px solid var(--border);
    border-radius: var(--radius);
    background: linear-gradient(180deg, rgba(255,255,255,.03), transparent 70%), var(--card);
    box-shadow: var(--shadow);
  }
  .mission-complete span{
    font-size: clamp(22px, 4vw, 34px);
    font-weight: 900;
    letter-spacing:.5px;
    background: linear-gradient(90deg, var(--brand), var(--brand-2), var(--accent));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-align:center;
  }

  /* Footer */
  footer{margin:30px auto; max-width:980px; color:var(--muted); text-align:center; padding:12px}
</style>
</head>
<body>

<header class="hero" aria-label="Header">
  <div class="hero__inner">
    <div class="hero__logo">
      <img src="cuny-logo-png.png" alt="CUNY logo" width="84" height="84" />
    </div>
    <div class="hero__text">
      <span class="eyebrow">Don‚Äôt AI Alone</span>
      <h1>Escape the Human + AI Vault</h1>
      <p class="tagline">Solve puzzles to unlock the exit. Collect keys by answering questions about when humans and AI work best together.</p>
    </div>
  </div>
</header>

<!-- ======= MISSION PAGE ======= -->
<section class="mission" id="mission">
  <div class="mission-card">
    <h2 class="mission-title">üéØ Mission Briefing</h2>
    <p class="mission-sub">You wake in a sealed vault. The only way out: prove you can collaborate with AI wisely.</p>
    <div class="mission-grid">
      <div class="scanner">
        <div class="scan-line"></div>
        <svg class="lock" viewBox="0 0 120 120" role="img" aria-label="Locked padlock">
          <g class="shackle" id="shackle">
            <path d="M40 40 a20 20 0 1 1 40 0 v14" fill="none" stroke="url(#grad)" stroke-width="8" stroke-linecap="round"/>
          </g>
          <rect x="28" y="50" rx="10" ry="10" width="64" height="54" fill="none" stroke="url(#grad)" stroke-width="8"/>
          <circle cx="60" cy="77" r="7" fill="none" stroke="url(#grad)" stroke-width="6"/>
          <defs>
            <linearGradient id="grad" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#60a5fa"/>
              <stop offset="100%" stop-color="#22d3ee"/>
            </linearGradient>
          </defs>
        </svg>
        <p style="margin:10px 0 0; color:var(--muted)">Vault Lock Status: <strong id="lockStatus">Locked</strong></p>
      </div>
      <div>
        <ol class="mission-steps">
          <li>Answer questions one-by-one. Each correct answer earns a üîë key.</li>
          <li>Gather <strong>6 keys</strong> to crack the exit lock.</li>
          <li>Use hints wisely; verify like a pro. Remember: <em>Don‚Äôt AI Alone.</em></li>
        </ol>
        <div class="mission-actions">
          <button id="beginBtn" class="btn" type="button">Begin Mission</button>
          <button id="howBtn" class="btn secondary" type="button">How it works</button>
        </div>
        <div id="howBox" style="display:none; margin-top:8px; color:var(--muted)">
          You‚Äôll see multiple-choice, true/false, and matching prompts. Click <em>Check Answer</em> for instant feedback. Earn enough keys to ‚Äúunlock‚Äù the padlock and reveal the exit.
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ======= QUIZ PAGE ======= -->
<main class="wrap" id="quizWrap">
  <section class="card" aria-labelledby="quiz-title">
    <div class="progress" role="status" aria-live="polite">
      <div class="progress__bar" aria-hidden="true"><span id="progressBar"></span></div>
      <div class="progress__count">
        <span id="progressCount">0</span>/<span id="totalCount">0</span>
        <span class="score_now">Score: <strong id="scoreNow">0</strong></span>
        <span class="keys_now">Keys: <strong id="keysNow">0</strong> üîë</span>
      </div>
    </div>

    <h2 id="quiz-title" class="visually-hidden">Challenge</h2>
    <div id="quiz"></div>

    <div class="actions">
      <button id="hintBtn" class="btn secondary" type="button">Show Hint</button>
      <div style="display:flex; gap:10px">
        <button id="restartBtn" class="btn secondary" type="button">Restart</button>
        <button id="checkBtn" class="btn" type="button">Check Answer</button>
        <button id="nextBtn" class="btn" type="button" style="display:none">Next Question</button>
      </div>
    </div>

    <div id="results" class="card">
      <div class="result-card">
        <div class="score-ring" id="scoreRing"><span id="scorePct">0%</span></div>
        <div>
          <h3 id="scoreText">Your Score</h3>
          <p class="result-msg" id="bandMsg"></p>
          <h2 class="result-msg" id="timeMsg"></h2>
        </div>
      </div>
      <div id="missionComplete" class="mission-complete" style="display:none">
        <span>üéâ Mission Accomplished ‚Äî You Escaped the Human + AI Vault! üéâ</span>
      </div>
    </div>
  </section>
</main>

<footer>
  <small>&copy; <span id="year"></span> Built with a custom GPT, reviewed by a human.</small>
</footer>

<script>
  // ======== QUIZ DATA (6 questions: removed previous Q6 & Q7) =========
  const quizData = [
    {
      id: 1, type: "mcq",
      prompt: "Which task is AI generally *better* at than humans?",
      options: ["Summarizing long reports quickly", "Comforting someone in a crisis", "Setting company values", "Negotiating team conflicts"],
      correct: "Summarizing long reports quickly",
      hint: "Think about scale and repetition.",
      explanation: "AI excels at high-volume, pattern-based tasks like summarizing; humans handle nuance and empathy."
    },
    {
      id: 2, type: "tf",
      prompt: "If an AI tool gives a confident answer, you can skip verification.",
      options: ["True","False"],
      correct: "False",
      hint: "Who is accountable?",
      explanation: "Confidence ‚â† correctness. Humans must verify important outputs before acting."
    },
    {
      id: 3, type: "match",
      prompt: "Match each task to who should lead it.",
      matchPairs: [
        {left:"Spot anomalies in 50,000 transactions", rightOptions:["Choose one","Human","AI","Both"], correct:"AI"},
        {left:"Decide on a refund for an angry customer", rightOptions:["Choose one","Human","AI","Both"], correct:"Human"},
        {left:"Double-check facts using different tools before publishing", rightOptions:["Choose one","Human","AI","Both"], correct:"Both"}
      ],
      hint: "Consider judgment vs. scale.",
      explanation: "AI scans large datasets; humans apply judgment for customer outcomes; both share verification."
    },
    {
      id: 4, type: "mcq",
      prompt: "What‚Äôs the best human + AI workflow for a policy memo?",
      options: [
        "AI drafts ‚Üí Human edits/verifies ‚Üí AI polishes grammar ‚Üí Human signs off",
        "Human writes from scratch and never uses AI",
        "AI writes and publishes automatically",
        "Human drafts ‚Üí AI publishes without review"
      ],
      correct: "AI drafts ‚Üí Human edits/verifies ‚Üí AI polishes grammar ‚Üí Human signs off",
      hint: "Put verification before final sign-off.",
      explanation: "A loop of draft ‚Üí verify ‚Üí polish ‚Üí approve keeps speed while protecting quality and accountability."
    },
    {
      id: 5, type: "tf",
      prompt: "Sharing private customer data with a public AI tool may create privacy risks.",
      options: ["True","False"],
      correct: "True",
      hint: "Think: confidentiality and consent.",
      explanation: "Public tools may retain or learn from data; follow privacy rules and use approved channels."
    },
    {
      id: 8, type: "tf",
      prompt: "‚ÄúAI hallucinations‚Äù means the system may produce invented facts that sound plausible.",
      options: ["True","False"],
      correct: "True",
      hint: "Listen for ‚Äúplausible but wrong.‚Äù",
      explanation: "Hallucinations are fabricated details; humans must cross-check with reliable sources."
    }
  ];

  // ======== STATE ========
  let current = 0;
  let score = 0;
  let keys = 0;        // üîë keys collected
  const total = quizData.length;

  // ======== TIMER ========
  let startTime = 0;
  let endTime = 0;

  // ======== HELPERS ========
  const $ = (sel, el=document) => el.querySelector(sel);
  const $$ = (sel, el=document) => [...el.querySelectorAll(sel)];
  function normalize(s){ return String(s).trim().toLowerCase(); }
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  // ======== ELEMENTS ========
  const quizWrap = $("#quizWrap");
  const mission = $("#mission");
  const quizEl = $("#quiz");
  const totalCountEl = $("#totalCount");
  const progressCountEl = $("#progressCount");
  const progressBar = $("#progressBar");
  const scoreNowEl = $("#scoreNow");
  const keysNowEl = $("#keysNow");
  const hintBtn = $("#hintBtn");
  const checkBtn = $("#checkBtn");
  const nextBtn = $("#nextBtn");
  const restartBtn = $("#restartBtn");
  const resultsEl = $("#results");
  const scoreRing = $("#scoreRing");
  const scorePct = $("#scorePct");
  const bandMsg = $("#bandMsg");
  const timeMsg = $("#timeMsg");
  const shackle = $("#shackle");
  const lockStatus = $("#lockStatus");
  const beginBtn = $("#beginBtn");
  const howBtn = $("#howBtn");
  const howBox = $("#howBox");

  $("#year").textContent = new Date().getFullYear();

  // ======== MISSION EVENTS ========
  howBtn.addEventListener("click", ()=>{
    howBox.style.display = (howBox.style.display === "none") ? "block" : "none";
  });
  beginBtn.addEventListener("click", ()=>{
    mission.style.display = "none";
    quizWrap.style.display = "block";
    startTime = Date.now(); // start timer
    renderQuestion();
    updateProgress();
  });

  // ======== RENDER ONE QUESTION ========
  function renderQuestion(){
    const q = quizData[current];
    quizEl.innerHTML = ""; // clear

    const card = document.createElement("div");
    card.className = "question";

    const title = document.createElement("p");
    title.className = "q-title";
    title.innerHTML = `<strong>Q${current+1} of ${total}.</strong> ${q.prompt}`;
    card.appendChild(title);

    if(q.type === "mcq" || q.type === "tf"){
      const wrap = document.createElement("div");
      wrap.className = "options";
      (q.options || []).forEach(opt => {
        const id = `q${current}-${opt.toLowerCase().replace(/[^a-z0-9]+/g,'-')}`;
        const label = document.createElement("label");
        label.setAttribute("for", id);
        label.innerHTML = `<input id="${id}" type="radio" name="q${current}" value="${escapeHtml(opt)}"> ${escapeHtml(opt)}`;
        wrap.appendChild(label);
      });
      card.appendChild(wrap);
    }
    else if(q.type === "match"){
      (q.matchPairs || []).forEach((pair, j) => {
        const row = document.createElement("div");
        row.className = "match-row";

        const left = document.createElement("div");
        left.className = "match-left";
        left.textContent = pair.left;

        const right = document.createElement("div");
        right.className = "match-right";

        const sel = document.createElement("select");
        sel.name = `q${current}-m${j}`;
        (pair.rightOptions || ["Human","AI","Both"]).forEach(opt => {
          const op = document.createElement("option");
          op.value = opt; op.textContent = opt;
          sel.appendChild(op);
        });
        right.appendChild(sel);

        row.appendChild(left);
        row.appendChild(right);
        card.appendChild(row);
      });
    }

    // Hint + Explanation + Feedback containers
    const hint = document.createElement("div");
    hint.className = "hint";
    hint.id = "hintBox";
    hint.textContent = q.hint || "Consider the strengths of humans and AI.";

    const feedback = document.createElement("div");
    feedback.className = "feedback";
    feedback.id = "feedbackBox";

    const explanation = document.createElement("div");
    explanation.className = "explanation";
    explanation.id = "explainBox";
    explanation.textContent = "Explanation: " + (q.explanation || "");

    card.appendChild(hint);
    card.appendChild(feedback);
    card.appendChild(explanation);

    quizEl.appendChild(card);

    // Reset buttons for this question
    hint.style.display = "none";
    feedback.style.display = "none";
    explanation.style.display = "none";
    checkBtn.style.display = "inline-block";
    nextBtn.style.display = "none";

    updateProgress();
  }

  // ======== PROGRESS ========
  function updateProgress(){
    totalCountEl && (totalCountEl.textContent = total);
    progressCountEl && (progressCountEl.textContent = current);
    const pct = total ? Math.round(100 * current / total) : 0;
    progressBar && (progressBar.style.width = pct + "%");
    scoreNowEl && (scoreNowEl.textContent = score);
    keysNowEl && (keysNowEl.textContent = keys);
  }

  // ======== CHECK ANSWER WITH FEEDBACK ========
  function checkAnswer(){
    const q = quizData[current];
    let correctNow = false;
    let correctText = "";

    if(q.type === "mcq" || q.type === "tf"){
      const selected = document.querySelector(`input[name="q${current}"]:checked`);
      if(!selected){ alert("Please select an answer first."); return; }
      const labels = [...document.querySelectorAll(`label[for^="q${current}-"]`)];
      labels.forEach(l => l.classList.remove("correct","wrong"));

      correctText = q.correct;
      labels.forEach(l => {
        const input = document.getElementById(l.getAttribute("for"));
        const val = input ? input.value : "";
        if(normalize(val) === normalize(q.correct)){
          l.classList.add("correct");
        }
      });

      if(normalize(selected.value) === normalize(q.correct)){
        correctNow = true;
      } else {
        const wrongLabel = document.querySelector(`label[for="${selected.id}"]`);
        if(wrongLabel) wrongLabel.classList.add("wrong");
      }

      // lock options
      $$(`input[name="q${current}"]`).forEach(i => i.disabled = true);
    } else if(q.type === "match"){
      const pairs = (q.matchPairs || []);
      let allRight = true;
      pairs.forEach((pair, j) => {
        const row = document.querySelector(`select[name="q${current}-m${j}"]`).closest(".match-row");
        const sel = row.querySelector("select");
        row.classList.remove("correct","wrong");
        if(normalize(sel.value) === normalize(pair.correct)){
          row.classList.add("correct");
        } else {
          row.classList.add("wrong");
          allRight = false;
        }
        correctText += `${pair.left} ‚Üí ${pair.correct}${j < pairs.length-1 ? "; " : ""}`;
        sel.disabled = true;
      });
      correctNow = allRight;
    }

    if(correctNow){
      score++;
      keys++; // award a key for each correctly answered question
      // open the lock when enough keys
      if(keys >= 6){
        const lock = document.querySelector(".lock");
        if(lock){
          lock.classList.add("open");
          lockStatus.textContent = "Unlocked";
        }
      }
    }

    // Show feedback + explanation + toggle buttons
    const fb = document.getElementById("feedbackBox");
    fb.style.display = "block";
    fb.textContent = correctNow ? "‚úÖ Correct! You found a key üîë" : `‚ùå Not quite. Correct answer: ${correctText}`;

    const exp = document.getElementById("explainBox");
    exp.style.display = "block";

    checkBtn.style.display = "none";
    nextBtn.style.display = "inline-block";
    nextBtn.textContent = (current === total-1) ? "See Results" : "Next Question";

    // Update live score + keys
    updateProgress();
  }

  // ======== NEXT OR RESULTS ========
  function nextStep(){
    if(current < total-1){
      current++;
      renderQuestion();
    }else{
      current++;
      showResults();
    }
  }

  // ======== RESULTS ========
  function showResults(){
    updateProgress();
    endTime = Date.now(); // stop timer
    const totalMs = Math.max(0, endTime - startTime);
    const mins = Math.floor(totalMs / 60000);
    const secs = Math.floor((totalMs % 60000) / 1000);
    const timeTaken = `${mins}m ${secs}s`;

    quizEl.innerHTML = "";
    $(".actions").style.display = "none";
    resultsEl.style.display = "block";

    const pct = total ? Math.round((score/total)*100) : 0;
    const escaped = keys >= 6;
    const band = escaped
      ? "üîì The door slides open ‚Äî you‚Äôve escaped the Human + AI Vault!"
      : "üîí So close! Gather 6 keys to unlock the exit. Try again and trust‚Äîbut verify.";

    scoreRing.style.setProperty("--pct", pct);
    scorePct.textContent = pct + "%";
    $("#scoreText").textContent = `Your Score: ${score}/${total} ‚Ä¢ Keys: ${keys}/6`;
    bandMsg.textContent = band;
    timeMsg.textContent = `‚è±Ô∏è Time Taken: ${timeTaken}`;

    // Show Mission Accomplished banner when escaped
    const missionComplete = document.getElementById("missionComplete");
    if(missionComplete){
      missionComplete.style.display = (escaped ? "grid" : "none");
    }

    confetti(pct >= 80 ? 60 : 20);
  }

  // ======== CONFETTI ========
  function confetti(n=30){
    for(let i=0;i<n;i++){
      const s = document.createElement("span");
      const size = 6 + Math.random()*8;
      s.style.position="fixed";
      s.style.left = Math.random()*100 + "vw";
      s.style.top = "-10px";
      s.style.width = size+"px";
      s.style.height = size+"px";
      s.style.background = i%3===0? "var(--brand)" : i%3===1? "var(--brand-2)" : "var(--accent)";
      s.style.borderRadius = "2px";
      s.style.opacity = ".9";
      s.style.transform = `rotate(${Math.random()*360}deg)`;
      s.style.transition = `transform ${2+Math.random()*1.5}s linear, top ${2+Math.random()*1.5}s linear, opacity .3s ease`;
      document.body.appendChild(s);
      requestAnimationFrame(()=>{
        s.style.top = 100 + "vh";
        s.style.transform += ` translateY(${100+Math.random()*40}vh) rotate(${(Math.random()*720-360)}deg)`;
      });
      setTimeout(()=>s.remove(), 2800);
    }
  }

  // ======== EVENTS ========
  document.getElementById("hintBtn").addEventListener("click", () => { const h=document.getElementById("hintBox"); if(h) h.style.display="block"; });
  document.getElementById("checkBtn").addEventListener("click", checkAnswer);
  document.getElementById("nextBtn").addEventListener("click", nextStep);
  document.getElementById("restartBtn").addEventListener("click", () => location.reload());

  // Initialize year
  document.getElementById("year").textContent = new Date().getFullYear();
</script>

</body>
</html>
